From e1dc32a71713670956764377dc49aac340f49fdd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stephan=20D=C3=BCnner?= <stephan.duenner@bytesatwork.ch>
Date: Fri, 13 Dec 2019 17:55:31 +0100
Subject: [PATCH] ARM: dts: stm32: bytedevkit: Add support for V1.1 and rename
 V1.0

---
 .../dts/stm32mp157c-bytedevkit-common.dtsi    |  95 +---------------
 .../boot/dts/stm32mp157c-bytedevkit-v1-0.dts  | 105 ++++++++++++++++++
 .../boot/dts/stm32mp157c-bytedevkit-v1-1.dts  | 104 +++++++++++++++++
 arch/arm/boot/dts/stm32mp157c-bytedevkit.dts  |   8 --
 4 files changed, 210 insertions(+), 102 deletions(-)
 create mode 100644 arch/arm/boot/dts/stm32mp157c-bytedevkit-v1-0.dts
 create mode 100644 arch/arm/boot/dts/stm32mp157c-bytedevkit-v1-1.dts
 delete mode 100644 arch/arm/boot/dts/stm32mp157c-bytedevkit.dts

diff --git a/arch/arm/boot/dts/stm32mp157c-bytedevkit-common.dtsi b/arch/arm/boot/dts/stm32mp157c-bytedevkit-common.dtsi
index 884504491657..94485d781cf0 100644
--- a/arch/arm/boot/dts/stm32mp157c-bytedevkit-common.dtsi
+++ b/arch/arm/boot/dts/stm32mp157c-bytedevkit-common.dtsi
@@ -1,15 +1,12 @@
 // SPDX-License-Identifier: GPL-2.0
 /*
- *  Copyright (C) 2019 bytes at work AG - http://www.bytesatwork.ch
+ *  Copyright (C) 2020 bytes at work AG - http://www.bytesatwork.ch
  */
 
 #include "stm32mp157c-byteengine-m5.dtsi"
 #include <dt-bindings/net/ti-dp83867.h>
 
 / {
-	model = "byteDEVKIT";
-	compatible = "batw,bytedevkit", "batw,m5", "st,stm32mp157";
-
 	aliases {
 		serial0 = &uart4;
 		ethernet0 = &ethernet0;
@@ -80,49 +77,6 @@
 		};
 	};
 
-	i2c3_pins: i2c3-0 {
-		pins {
-			pinmux = <STM32_PINMUX('H', 7, AF4)>, /* I2C3_SCL */
-				 <STM32_PINMUX('H', 8, AF4)>; /* I2C3_SDA */
-			bias-pull-up;
-			drive-open-drain;
-			slew-rate = <0>;
-		};
-	};
-
-	i2c3_pins_sleep: i2c3-1 {
-		pins {
-			pinmux = <STM32_PINMUX('H', 7, ANALOG)>, /* I2C3_SCL */
-				 <STM32_PINMUX('H', 8, ANALOG)>; /* I2C3_SDA */
-		};
-	};
-
-	ethernet0_rgmii_pins: rgmii-0 {
-		pins1 {
-			pinmux = <STM32_PINMUX('G', 4, AF11)>, /* ETH_RGMII_GTX_CLK */
-				 <STM32_PINMUX('B', 12, AF11)>, /* ETH_RGMII_TXD0 */
-				 <STM32_PINMUX('G', 14, AF11)>, /* ETH_RGMII_TXD1 */
-				 <STM32_PINMUX('C', 2, AF11)>, /* ETH_RGMII_TXD2 */
-				 <STM32_PINMUX('E', 2, AF11)>, /* ETH_RGMII_TXD3 */
-				 <STM32_PINMUX('G', 11, AF11)>, /* ETH_RGMII_TX_CTL */
-				 <STM32_PINMUX('A', 2, AF11)>, /* ETH_MDIO */
-				 <STM32_PINMUX('C', 1, AF11)>; /* ETH_MDC */
-			bias-disable;
-			drive-push-pull;
-			slew-rate = <2>;
-		};
-
-		pins2 {
-			pinmux = <STM32_PINMUX('C', 4, AF11)>, /* ETH_RGMII_RXD0 */
-				 <STM32_PINMUX('C', 5, AF11)>, /* ETH_RGMII_RXD1 */
-				 <STM32_PINMUX('H', 6, AF11)>, /* ETH_RGMII_RXD2 */
-				 <STM32_PINMUX('B', 1, AF11)>, /* ETH_RGMII_RXD3 */
-				 <STM32_PINMUX('A', 1, AF11)>, /* ETH_RGMII_RX_CLK */
-				 <STM32_PINMUX('A', 7, AF11)>; /* ETH_RGMII_RX_CTL */
-			bias-disable;
-		};
-	};
-
 	pwm2_pins: pwm2-0 {
 		pins {
 			pinmux = <STM32_PINMUX('G', 8, AF1)>; /* TIM2_CH1 */
@@ -197,32 +151,6 @@
 	status = "okay";
 };
 
-&ethernet0 {
-	status = "okay";
-	pinctrl-0 = <&ethernet0_rgmii_pins>;
-	pinctrl-names = "default";
-	phy-mode = "rgmii";
-	phy-handle = <&phy0>;
-	st,eth_clk_sel = <1>;
-	max-speed = <1000>;
-	clock-names = "stmmaceth", "mac-clk-tx", "mac-clk-rx", "eth-ck", "syscfg-clk", "ethstp";
-	clocks = <&rcc ETHMAC>,<&rcc ETHTX>,<&rcc ETHRX>,<&rcc ETHCK_K>,<&rcc SYSCFG>,<&rcc ETHSTP>;
-
-	mdio0 {
-		#address-cells = <1>;
-		#size-cells = <0>;
-		compatible = "snps,dwmac-mdio";
-		phy0: ethernet-phy@0 {
-			reg = <0>;
-			ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_25_NS>;
-			ti,tx-internal-delay = <DP83867_RGMIIDCTL_250_PS>;
-			ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_8_B_NIB>;
-			ti,min-output-impedance;
-			ti,dp83867-rxctrl-strap-quirk;
-		};
-	};
-};
-
 &iwdg2 {
 	timeout-sec = <32>;
 	status = "okay";
@@ -298,27 +226,6 @@
 	};
 };
 
-&i2c3 {
-	pinctrl-names = "default", "sleep";
-	pinctrl-0 = <&i2c3_pins>;
-	pinctrl-1 = <&i2c3_pins_sleep>;
-	i2c-scl-rising-time-ns = <185>;
-	i2c-scl-falling-time-ns = <20>;
-	status = "okay";
-	/delete-property/dmas;
-	/delete-property/dma-names;
-
-	gt911@5d {
-		compatible = "goodix,gt911";
-		reg = <0x5d>;
-		interrupt-parent = <&gpiob>;
-		interrupts = <7 0>;
-
-		irq-gpios = <&gpiob 7 0>;
-		reset-gpios = <&gpiod 3 0>;
-	};
-};
-
 &rtc {
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/stm32mp157c-bytedevkit-v1-0.dts b/arch/arm/boot/dts/stm32mp157c-bytedevkit-v1-0.dts
new file mode 100644
index 000000000000..c7fcb4be0ab2
--- /dev/null
+++ b/arch/arm/boot/dts/stm32mp157c-bytedevkit-v1-0.dts
@@ -0,0 +1,105 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ *  Copyright (C) 2020 bytes at work AG - http://www.bytesatwork.ch
+ */
+
+/dts-v1/;
+
+#include "stm32mp157c-bytedevkit-common.dtsi"
+
+/ {
+	model = "byteDEVKIT V1.0";
+	compatible = "batw,bytedevkit-v1-0", "batw,bytedevkit", "batw,m5", "st,stm32mp157";
+};
+
+&pinctrl {
+	i2c3_pins: i2c3-0 {
+		pins {
+			pinmux = <STM32_PINMUX('H', 7, AF4)>, /* I2C3_SCL */
+				 <STM32_PINMUX('H', 8, AF4)>; /* I2C3_SDA */
+			bias-pull-up;
+			drive-open-drain;
+			slew-rate = <0>;
+		};
+	};
+
+	i2c3_pins_sleep: i2c3-1 {
+		pins {
+			pinmux = <STM32_PINMUX('H', 7, ANALOG)>, /* I2C3_SCL */
+				 <STM32_PINMUX('H', 8, ANALOG)>; /* I2C3_SDA */
+		};
+	};
+
+	ethernet0_rgmii_pins: rgmii-0 {
+		pins1 {
+			pinmux = <STM32_PINMUX('G', 4, AF11)>, /* ETH_RGMII_GTX_CLK */
+				 <STM32_PINMUX('B', 12, AF11)>, /* ETH_RGMII_TXD0 */
+				 <STM32_PINMUX('G', 14, AF11)>, /* ETH_RGMII_TXD1 */
+				 <STM32_PINMUX('C', 2, AF11)>, /* ETH_RGMII_TXD2 */
+				 <STM32_PINMUX('E', 2, AF11)>, /* ETH_RGMII_TXD3 */
+				 <STM32_PINMUX('G', 11, AF11)>, /* ETH_RGMII_TX_CTL */
+				 <STM32_PINMUX('A', 2, AF11)>, /* ETH_MDIO */
+				 <STM32_PINMUX('C', 1, AF11)>; /* ETH_MDC */
+			bias-disable;
+			drive-push-pull;
+			slew-rate = <2>;
+		};
+
+		pins2 {
+			pinmux = <STM32_PINMUX('C', 4, AF11)>, /* ETH_RGMII_RXD0 */
+				 <STM32_PINMUX('C', 5, AF11)>, /* ETH_RGMII_RXD1 */
+				 <STM32_PINMUX('H', 6, AF11)>, /* ETH_RGMII_RXD2 */
+				 <STM32_PINMUX('B', 1, AF11)>, /* ETH_RGMII_RXD3 */
+				 <STM32_PINMUX('A', 1, AF11)>, /* ETH_RGMII_RX_CLK */
+				 <STM32_PINMUX('A', 7, AF11)>; /* ETH_RGMII_RX_CTL */
+			bias-disable;
+		};
+	};
+};
+
+&ethernet0 {
+	status = "okay";
+	pinctrl-0 = <&ethernet0_rgmii_pins>;
+	pinctrl-names = "default";
+	phy-mode = "rgmii";
+	phy-handle = <&phy0>;
+	st,eth_clk_sel = <1>;
+	max-speed = <1000>;
+	clock-names = "stmmaceth", "mac-clk-tx", "mac-clk-rx", "eth-ck", "syscfg-clk", "ethstp";
+	clocks = <&rcc ETHMAC>, <&rcc ETHTX>, <&rcc ETHRX>, <&rcc ETHCK_K>, <&rcc SYSCFG>, <&rcc ETHSTP>;
+
+	mdio0 {
+		#address-cells = <1>;
+		#size-cells = <0>;
+		compatible = "snps,dwmac-mdio";
+		phy0: ethernet-phy@0 {
+			reg = <0>;
+			ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_25_NS>;
+			ti,tx-internal-delay = <DP83867_RGMIIDCTL_250_PS>;
+			ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_8_B_NIB>;
+			ti,min-output-impedance;
+			ti,dp83867-rxctrl-strap-quirk;
+		};
+	};
+};
+
+&i2c3 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&i2c3_pins>;
+	pinctrl-1 = <&i2c3_pins_sleep>;
+	i2c-scl-rising-time-ns = <185>;
+	i2c-scl-falling-time-ns = <20>;
+	status = "okay";
+	/delete-property/dmas;
+	/delete-property/dma-names;
+
+	gt911@5d {
+		compatible = "goodix,gt911";
+		reg = <0x5d>;
+		interrupt-parent = <&gpiob>;
+		interrupts = <7 0>;
+
+		irq-gpios = <&gpiob 7 0>;
+		reset-gpios = <&gpiod 3 0>;
+	};
+};
diff --git a/arch/arm/boot/dts/stm32mp157c-bytedevkit-v1-1.dts b/arch/arm/boot/dts/stm32mp157c-bytedevkit-v1-1.dts
new file mode 100644
index 000000000000..ecc3e48ed37f
--- /dev/null
+++ b/arch/arm/boot/dts/stm32mp157c-bytedevkit-v1-1.dts
@@ -0,0 +1,104 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ *  Copyright (C) 2020 bytes at work AG - http://www.bytesatwork.ch
+ */
+
+/dts-v1/;
+
+#include "stm32mp157c-bytedevkit-common.dtsi"
+
+/ {
+	model = "byteDEVKIT V1.1";
+	compatible = "batw,bytedevkit-v1-1", "batw,bytedevkit", "batw,m5", "st,stm32mp157";
+};
+
+&pinctrl {
+	i2c2_pins: i2c2-0 {
+		pins {
+			pinmux = <STM32_PINMUX('H', 4, AF4)>, /* I2C3_SCL */
+				 <STM32_PINMUX('H', 5, AF4)>; /* I2C3_SDA */
+			bias-pull-up;
+			drive-open-drain;
+			slew-rate = <0>;
+		};
+	};
+
+	i2c2_pins_sleep: i2c2-1 {
+		pins {
+			pinmux = <STM32_PINMUX('H', 4, ANALOG)>, /* I2C3_SCL */
+				 <STM32_PINMUX('H', 5, ANALOG)>; /* I2C3_SDA */
+		};
+	};
+
+	ethernet0_rgmii_pins: rgmii-0 {
+		pins1 {
+			pinmux = <STM32_PINMUX('G', 4, AF11)>, /* ETH_RGMII_GTX_CLK */
+				 <STM32_PINMUX('B', 12, AF11)>, /* ETH_RGMII_TXD0 */
+				 <STM32_PINMUX('G', 14, AF11)>, /* ETH_RGMII_TXD1 */
+				 <STM32_PINMUX('C', 2, AF11)>, /* ETH_RGMII_TXD2 */
+				 <STM32_PINMUX('E', 2, AF11)>, /* ETH_RGMII_TXD3 */
+				 <STM32_PINMUX('G', 11, AF11)>, /* ETH_RGMII_TX_CTL */
+				 <STM32_PINMUX('A', 2, AF11)>, /* ETH_MDIO */
+				 <STM32_PINMUX('C', 1, AF11)>; /* ETH_MDC */
+			bias-disable;
+			drive-push-pull;
+			slew-rate = <2>;
+		};
+
+		pins2 {
+			pinmux = <STM32_PINMUX('C', 4, AF11)>, /* ETH_RGMII_RXD0 */
+				 <STM32_PINMUX('C', 5, AF11)>, /* ETH_RGMII_RXD1 */
+				 <STM32_PINMUX('H', 6, AF11)>, /* ETH_RGMII_RXD2 */
+				 <STM32_PINMUX('H', 7, AF11)>, /* ETH_RGMII_RXD3 */
+				 <STM32_PINMUX('A', 1, AF11)>, /* ETH_RGMII_RX_CLK */
+				 <STM32_PINMUX('A', 7, AF11)>; /* ETH_RGMII_RX_CTL */
+			bias-disable;
+		};
+	};
+};
+
+&ethernet0 {
+	status = "okay";
+	pinctrl-0 = <&ethernet0_rgmii_pins>;
+	pinctrl-names = "default";
+	phy-mode = "rgmii";
+	phy-handle = <&phy0>;
+	st,eth_clk_sel = <1>;
+	max-speed = <1000>;
+	clock-names = "stmmaceth", "mac-clk-tx", "mac-clk-rx", "eth-ck", "syscfg-clk", "ethstp";
+	clocks = <&rcc ETHMAC>, <&rcc ETHTX>, <&rcc ETHRX>, <&rcc ETHCK_K>, <&rcc SYSCFG>, <&rcc ETHSTP>;
+
+	mdio0 {
+		#address-cells = <1>;
+		#size-cells = <0>;
+		compatible = "snps,dwmac-mdio";
+		phy0: ethernet-phy@0 {
+			reg = <0>;
+			ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_25_NS>;
+			ti,tx-internal-delay = <DP83867_RGMIIDCTL_2_75_NS>;
+			ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
+			ti,dp83867-rxctrl-strap-quirk;
+		};
+	};
+};
+
+&i2c2 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&i2c2_pins>;
+	pinctrl-1 = <&i2c2_pins_sleep>;
+	i2c-scl-rising-time-ns = <185>;
+	i2c-scl-falling-time-ns = <20>;
+	status = "okay";
+	/delete-property/dmas;
+	/delete-property/dma-names;
+
+	gt911@5d {
+		compatible = "goodix,gt911";
+		reg = <0x5d>;
+		interrupt-parent = <&gpiob>;
+		interrupts = <7 0>;
+
+		irq-gpios = <&gpiob 7 0>;
+		reset-gpios = <&gpiod 3 0>;
+	};
+};
diff --git a/arch/arm/boot/dts/stm32mp157c-bytedevkit.dts b/arch/arm/boot/dts/stm32mp157c-bytedevkit.dts
deleted file mode 100644
index e9bdf4ad8315..000000000000
--- a/arch/arm/boot/dts/stm32mp157c-bytedevkit.dts
+++ /dev/null
@@ -1,8 +0,0 @@
-// SPDX-License-Identifier: GPL-2.0
-/*
- *  Copyright (C) 2019 bytes at work AG - http://www.bytesatwork.ch
- */
-
-/dts-v1/;
-
-#include "stm32mp157c-bytedevkit-common.dtsi"
-- 
2.20.1

