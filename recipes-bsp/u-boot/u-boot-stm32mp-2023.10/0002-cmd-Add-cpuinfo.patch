From dcbcf2e84c1402664c9b1041db3bf0b9d8a20ed7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stephan=20D=C3=BCnner?= <stephan.duenner@bytesatwork.ch>
Date: Fri, 9 Aug 2019 19:17:33 +0200
Subject: [PATCH] cmd: Add cpuinfo
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Add command to print information about CPU.

Signed-off-by: Stephan DÃ¼nner <stephan.duenner@bytesatwork.ch>
Signed-off-by: Simone Schwizer <simone.schwizer@bytesatwork.ch>
---
 MAINTAINERS   |  1 +
 cmd/Kconfig   |  6 ++++++
 cmd/Makefile  |  1 +
 cmd/cpuinfo.c | 37 +++++++++++++++++++++++++++++++++++++
 4 files changed, 45 insertions(+)
 create mode 100644 cmd/cpuinfo.c

diff --git a/MAINTAINERS b/MAINTAINERS
index d4b2f23953..2982311e19 100644
--- a/MAINTAINERS
+++ b/MAINTAINERS
@@ -254,6 +254,7 @@ S:	Maintained
 W:	https://www.bytesatwork.io/
 T:	git https://github.com/bytesatwork/u-boot-stm32mp
 F:	.github/workflows/checkpatch.yml
+F:	cmd/cpuinfo.c
 
 ARM CORTINA ACCESS CAxxxx
 M:	Alex Nemirovsky <alex.nemirovsky@cortina-access.com>
diff --git a/cmd/Kconfig b/cmd/Kconfig
index 43ca10f69c..004056874b 100644
--- a/cmd/Kconfig
+++ b/cmd/Kconfig
@@ -170,6 +170,12 @@ config CMD_CPU
 	  internal name) and clock frequency. Other information may be
 	  available depending on the CPU driver.
 
+config CMD_CPUINFO
+	bool "cpuinfo"
+	help
+	  Print information about the CPU such as type, revision, clock rate
+	  and temperature grade.
+
 config CMD_FWU_METADATA
 	bool "fwu metadata read"
 	depends on FWU_MULTI_BANK_UPDATE
diff --git a/cmd/Makefile b/cmd/Makefile
index 9bebf321c3..95f78b8ed8 100644
--- a/cmd/Makefile
+++ b/cmd/Makefile
@@ -51,6 +51,7 @@ obj-$(CONFIG_CMD_CONFIG) += config.o
 obj-$(CONFIG_CMD_CONITRACE) += conitrace.o
 obj-$(CONFIG_CMD_CONSOLE) += console.o
 obj-$(CONFIG_CMD_CPU) += cpu.o
+obj-$(CONFIG_CMD_CPUINFO) += cpuinfo.o
 obj-$(CONFIG_CMD_DATE) += date.o
 obj-$(CONFIG_CMD_DEMO) += demo.o
 obj-$(CONFIG_CMD_DM) += dm.o
diff --git a/cmd/cpuinfo.c b/cmd/cpuinfo.c
new file mode 100644
index 0000000000..9a5a0081f1
--- /dev/null
+++ b/cmd/cpuinfo.c
@@ -0,0 +1,37 @@
+// SPDX-License-Identifier: GPL-2.0+
+/*
+ * Copyright (C) 2025 bytesatwork AG - https://www.bytesatwork.io
+ */
+
+#include <command.h>
+#include <cpu.h>
+#include <dm.h>
+#include <init.h>
+
+static int do_cpuinfo(struct cmd_tbl *cmdtp, int flag, int argc, char * const argv[])
+{
+#if IS_ENABLED(CONFIG_DM) && IS_ENABLED(CONFIG_CPU)
+	struct udevice *dev;
+	char buf[256];
+	int ret;
+
+	ret = uclass_get_device(UCLASS_CPU, 0, &dev);
+	if (ret) {
+		printf("Failed to get CPU device: %d\n", ret);
+		return ret;
+	}
+
+	ret = cpu_get_desc(dev, buf, sizeof(buf));
+	if (ret) {
+		printf("Failed to get CPU description: %d\n", ret);
+		return ret;
+	}
+
+	puts(buf);
+	return 0;
+#else
+	return print_cpuinfo();
+#endif
+}
+
+U_BOOT_CMD(cpuinfo, 1, 1, do_cpuinfo, "show cpu info", "");
