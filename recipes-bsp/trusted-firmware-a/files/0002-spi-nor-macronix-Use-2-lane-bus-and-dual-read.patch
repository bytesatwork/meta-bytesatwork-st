From ebadf9967b50fc681028fba291351dd4a14c4773 Mon Sep 17 00:00:00 2001
From: Guy Morand <guy.morand@bytesatwork.ch>
Date: Thu, 4 Jul 2024 11:43:55 +0200
Subject: [PATCH] spi-nor: macronix: Use 2 lane bus and dual read

Macronix doesn't support quad spi, use dual instead.

Signed-off-by: Markus Kappeler <markus.kappeler@bytesatwork.ch>
Signed-off-by: Guy Morand <guy.morand@bytesatwork.ch>
---
 plat/st/stm32mp1/stm32mp1_boot_device.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/plat/st/stm32mp1/stm32mp1_boot_device.c b/plat/st/stm32mp1/stm32mp1_boot_device.c
index 63d528503..b122c0c4a 100644
--- a/plat/st/stm32mp1/stm32mp1_boot_device.c
+++ b/plat/st/stm32mp1/stm32mp1_boot_device.c
@@ -197,14 +197,14 @@ int plat_get_nor_data(struct nor_device *device)
 	device->flags |= SPI_NOR_USE_BANK;
 
 	zeromem(&device->read_op, sizeof(struct spi_mem_op));
-	device->read_op.cmd.opcode = SPI_NOR_OP_READ_1_1_4;
+	device->read_op.cmd.opcode = SPI_NOR_OP_READ_1_1_2;
 	device->read_op.cmd.nbytes = 1U;
 	device->read_op.cmd.buswidth = SPI_MEM_BUSWIDTH_1_LINE;
 	device->read_op.addr.nbytes = 3U;
 	device->read_op.addr.buswidth = SPI_MEM_BUSWIDTH_1_LINE;
 	device->read_op.dummy.nbytes = 1U;
 	device->read_op.dummy.buswidth = SPI_MEM_BUSWIDTH_1_LINE;
-	device->read_op.data.buswidth = SPI_MEM_BUSWIDTH_4_LINE;
+	device->read_op.data.buswidth = SPI_MEM_BUSWIDTH_2_LINE;
 	device->read_op.data.dir = SPI_MEM_DATA_IN;
 
 	return 0;
-- 
2.39.5

